# Capture All

A Chrome extension that records network logs, user interactions, and DOM element snapshots — and exports both JSON and a fully self-contained interactive HTML Timeline for instant, human-readable visualization.

- **Network Logging**: via Chrome Debugger API
- **User Interactions**: clicks, scrolls, drags, inputs, key events
- **Element Snapshots**: DOM metadata, selectors, positions, visibility
- **Dual Export**: JSON + interactive HTML timeline (autogenerated)
- **Playback**: play/pause/reset, variable speed, live “Current Event”
- **Privacy**: all data stays local

## Highlights

- **One-click Export → Two Files**
  - `capture_all_logs_[timestamp].json`
  - `capture_all_timeline_[timestamp].html` (self-contained; open in any browser)
- **Parallel Timeline Tracks**
  - Network Requests
  - User Interactions
  - Element Snapshots
- **Playback Controls**
  - Play / Pause / Reset
  - 0.5x, 1x, 2x, 5x, 10x speeds
  - Live “Current Event” updates as the cursor moves
- **Compact, Scrollable Timeline**
  - Smaller event cards
  - Horizontal scrolling for long sessions
  - Tooltips for full event titles

## Installation

1. Clone or download this repository.
2. Open Chrome and go to `chrome://extensions/`.
3. Toggle on “Developer mode”.
4. Click “Load unpacked” and select this folder.

## File Structure

- `manifest.json`
  - Declares permissions: `activeTab`, `storage`, `tabs`, `scripting`, `debugger`, `downloads`
  - Registers background service worker: `background.js`
  - Popup: `popup.html`, `popup.js`
- `background.js`
  - Attaches Chrome Debugger
  - Captures network events: requestWillBeSent, responseReceived, loadingFinished, loadingFailed
  - Receives interaction logs from content script
  - Coordinates exports (JSON + HTML)
  - Generates the self-contained timeline HTML
- `content.js`
  - Tracks interactions: click, scroll, drag, input, keydown, mousemove (where applicable)
  - Captures element snapshots on demand
  - Sends `logInteraction` messages to background
- `popup.html` / `popup.js`
  - UI for Start/Stop recording
  - Capture Elements
  - Export Logs (triggers JSON + HTML)
  - Clear Logs
  - Real-time stats panel

## Permissions

- `activeTab`, `tabs`, `scripting`: inject and communicate with pages
- `storage`: persist interactions and element snapshots
- `debugger`: network logging via Chrome Debugger API
- `downloads`: save JSON and HTML files automatically
- `host_permissions`: `<all_urls>` for broad page access

## Usage

1. Open the popup.
2. Click “Start Recording”.
3. Interact with the page (click, scroll, drag, type, etc.).
4. Optionally click “Capture Elements” to snapshot visible interactive elements.
5. Click “Stop Recording”.
6. Click “Export Logs”.
   - You’ll get both:
     - JSON data export
     - HTML timeline export (open it directly in any browser)

## Exported Files

- `capture_all_logs_[timestamp].json`
  - Raw data for programmatic analysis
- `capture_all_timeline_[timestamp].html`
  - Single-file timeline viewer (no external dependencies)
  - Includes:
    - Parallel tracks (Network / Interactions / Snapshots)
    - Compact, scrollable event cards
    - Playback cursor with Play/Pause/Reset + speed
    - Live “Current Event” panel updating as the cursor moves
    - Click an event for detailed metadata panel

## Data Model

Example structure of `capture_all_logs_[timestamp].json`:

```json
{
  "exportDate": "2025-10-06T00:00:00.000Z",
  "tabId": 123,
  "networkLogs": [
    {
      "type": "request",
      "timestamp": 1690000000000,
      "requestId": "ABC123.1",
      "url": "https://example.com/api",
      "method": "GET",
      "headers": {},
      "postData": null,
      "response": {
        "status": 200,
        "statusText": "OK",
        "headers": {},
        "timestamp": 1690000000500
      },
      "loadingFinished": {
        "timestamp": 1690000000600,
        "encodedDataLength": 12345
      }
    }
  ],
  "interactionLogs": [
    {
      "type": "click",
      "timestamp": 1690000001000,
      "element": {
        "tagName": "BUTTON",
        "id": "submit-btn",
        "className": "btn primary",
        "xpath": "/html/body/div[1]/button[1]",
        "selector": "div > button.btn.primary",
        "text": "Submit",
        "attributes": {},
        "position": { "top": 100, "left": 50, "width": 120, "height": 40 },
        "visible": true
      },
      "clientX": 250,
      "clientY": 150,
      "pageX": 250,
      "pageY": 650,
      "screenX": 300,
      "screenY": 200,
      "url": "https://example.com",
      "viewport": {
        "width": 1920,
        "height": 1080,
        "scrollX": 0,
        "scrollY": 500,
        "devicePixelRatio": 1
      }
    }
  ],
  "elementSnapshots": [
    {
      "timestamp": 1690000002000,
      "url": "https://example.com",
      "elements": [
        {
          "tagName": "A",
          "id": null,
          "className": "nav-link",
          "xpath": "/html/body/nav/a[1]",
          "selector": "nav > a.nav-link",
          "text": "Home",
          "attributes": { "href": "/home" },
          "position": { "top": 20, "left": 100, "width": 80, "height": 30 },
          "visible": true
        }
      ],
      "viewport": { "width": 1920, "height": 1080, "scrollX": 0, "scrollY": 0, "devicePixelRatio": 1 }
    }
  ],
  "summary": {
    "totalNetworkRequests": 45,
    "totalInteractions": 23,
    "totalElementSnapshots": 3
  }
}
```

Notes:
- Interaction titles in the HTML are resilient to missing fields, e.g., “Click” without coordinates when unavailable.
- Network events are grouped by their timestamps and shown relative to the session start.

## Timeline Viewer (HTML) – Key Features

- Compact event pills (30px height) with ellipsis and tooltip for long labels
- Horizontal scroll for wide/long sessions
- Playback cursor track
- Live Current Event panel that updates while playing
- Click-to-expand details for Network/Interaction/Snapshot
- Responsive layout

## How It Works (Under the Hood)

- `background.js`
  - `startRecording(tabId)`
    - `chrome.debugger.attach({ tabId }, '1.3')`
    - `Network.enable`, `Runtime.enable`
  - Network event handlers:
    - `Network.requestWillBeSent` → capture method, URL, headers, postData
    - `Network.responseReceived` → status, statusText, headers
    - `Network.loadingFinished`/`loadingFailed` → completion/failure
  - Interaction logging:
    - Receives `logInteraction` from `content.js` and stores in `chrome.storage.local`
  - Export:
    - Aggregates network + interactions + snapshots
    - Saves JSON
    - Generates and saves a self-contained HTML timeline
- `content.js`
  - Sends user interactions to background via `logInteraction`
  - Provides `captureElements` snapshot on demand
- `popup.js`
  - Sends control messages: start/stop/capture/export/clear
  - Displays counts (network, interactions, snapshots)

## Usage Tips

- Start recording before interacting with the page
- Use “Capture Elements” after the page stabilizes to snapshot meaningful elements
- Export after stopping to ensure timeline includes all events
- Share the HTML file with teammates — no setup required

## Troubleshooting

- Recording won’t start
  - Another debugger may be attached. Refresh the page and try again.
- Missing interaction events
  - Content script injection may have failed on restricted pages (e.g., chrome://)
- Network count not updating
  - Ensure popup uses `response.networkLogsCount`
- Exports don’t download
  - Ensure `downloads` permission is present and allowed in Chrome
- HTML looks empty
  - Check that there are events in the JSON; re-export after recording some actions

## Privacy

- All data is stored locally in your browser
- Nothing is sent to external servers
- Input capture avoids storing sensitive values directly when possible

## Roadmap

- Screenshots on key events
- Full session replay
- Heatmaps
- CSV export
- Filters and search
- Multi-tab session stitching

## License

Free to use and modify for personal and commercial projects.

## Support

- Chrome Extensions docs: `https://developer.chrome.com/docs/extensions/`
- Debugger API: `https://developer.chrome.com/docs/extensions/reference/api/debugger`

- Added details for auto HTML export, compact timeline, live current-event, and scrollable tracks.
- Kept install, usage, data structure, troubleshooting, and privacy sections concise and practical.
